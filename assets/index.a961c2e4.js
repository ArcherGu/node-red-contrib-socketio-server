var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,o=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable,a=(t,o,s)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,r=(e,r)=>{for(var n in r||(r={}))t.call(r,n)&&a(e,n,r[n]);if(o)for(var n of o(r))s.call(r,n)&&a(e,n,r[n]);return e};import{d as n,r as l,t as i,_ as c,a as d,c as u,o as m,w as p,b as h,e as f,f as v,g as y,i as g,n as k,h as w,F as b,j as C,k as O,l as L,m as U,p as V}from"./vendor.25a5faef.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const s=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,r)=>{const n=new URL(e,s);if(self[t].moduleMap[n])return o(self[t].moduleMap[n]);const l=new Blob([`import * as m from '${n}';`,`${t}.moduleMap['${n}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){r(new Error(`Failed to import: ${e}`)),a(i)},onload(){o(self[t].moduleMap[n]),a(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/node-red-contrib-socketio-server/assets/");var _=n({name:"ChatWithWho",emits:["update-opts"],components:{},props:{},setup(e,{emit:t}){const o=l({you:"",friend:"",address:"https://node-red-for-hero-ku.herokuapp.com/"});return r(r({},i(o)),{handleOk:()=>{o.you&&o.friend&&o.address?o.you.indexOf("@")>-1||o.friend.indexOf("@")>-1?c.warning('Please do not use a name with the "@"!'):o.you.trim()!==o.friend.trim()?t("update-opts",r({},o)):c.warning("Please don't chat with yourself!"):c.warning("Please fill in the full information!")}})}});const j=h("div",{class:"title"}," Your name ",-1),M=h("div",{class:"title"}," Who do you want to chat with? ",-1),P=h("div",{class:"title"}," Server address ",-1),W=f(" Let's Chat! ");_.render=function(e,t,o,s,a,r){const n=d("el-input"),l=d("el-button"),i=d("el-card");return m(),u(i,{class:"chat-with-who"},{default:p((()=>[j,h(n,{modelValue:e.you,"onUpdate:modelValue":t[1]||(t[1]=t=>e.you=t),class:"demo-input",placeholder:"An imaginary you, such as Tom"},null,8,["modelValue"]),M,h(n,{modelValue:e.friend,"onUpdate:modelValue":t[2]||(t[2]=t=>e.friend=t),class:"demo-input",placeholder:"An imaginary friend, such as Jerry"},null,8,["modelValue"]),P,h(n,{modelValue:e.address,"onUpdate:modelValue":t[3]||(t[3]=t=>e.address=t),class:"demo-input",placeholder:"Socket.io server address"},null,8,["modelValue"]),h(l,{class:"ok-btn",type:"primary",onClick:e.handleOk},{default:p((()=>[W])),_:1},8,["onClick"])])),_:1})};var S=n({name:"ChatDemo",emits:["link-error"],components:{},props:{},setup(e,{emit:t}){const o=v(null),s=l({history:[],message:"",opts:null});let a;const n=async e=>{s.history.push(e),await k(),o.value.scrollTop=o.value.scrollHeight};return y((()=>{null==a||a.emit("leave"),null==a||a.close()})),r(r({},i(s)),{chatWindow:o,initChatSocketIO:e=>{s.opts=r({},e);const o=[e.you,e.friend].sort(((e,t)=>t.localeCompare(e)));try{a=g(e.address,{reconnection:!1,query:{room:`${o[0]}@${o[1]}`}}),a.on("connect_error",(e=>{console.error(e),t("link-error")})),a.on("message",n)}catch(l){console.error(l),t("link-error")}},isSendMsg:e=>{var t;return e==(null==(t=s.opts)?void 0:t.you)},sendMsg:()=>{var e,t;if(!s.message.trim())return s.message="",void c.warning("Please enter the message!");a.emit("message",{from:null==(e=s.opts)?void 0:e.you,to:null==(t=s.opts)?void 0:t.friend,msg:s.message}),s.message=""}})}});const A={class:"chat-title"},E={class:"chat-window",ref:"chatWindow"},D={key:0,class:"history-send"},R={class:"message-text"},$=h("img",{class:"avatar",src:"/node-red-contrib-socketio-server/assets/jerry.cf495e9c.png"},null,-1),x={key:1,class:"history-receive"},F=h("img",{class:"avatar",src:"/node-red-contrib-socketio-server/assets/tom.a3bb82df.png"},null,-1),I={class:"message-text"},T={class:"chat-input"};S.render=function(e,t,o,s,a,r){const n=d("el-button"),l=d("el-input"),i=d("el-card");return m(),u(i,{class:"chat-demo"},{default:p((()=>{var o;return[h("div",A," Chat with "+w(null==(o=e.opts)?void 0:o.friend),1),h("div",E,[(m(!0),u(b,null,C(e.history,(t=>(m(),u(b,null,[e.isSendMsg(t.from)?(m(),u("div",D,[h("div",R,w(t.msg),1),$])):(m(),u("div",x,[F,h("div",I,w(t.msg),1)]))],64)))),256))],512),h("div",T,[h(l,{modelValue:e.message,"onUpdate:modelValue":t[1]||(t[1]=t=>e.message=t),placeholder:"message..."},{append:p((()=>[h(n,{icon:"el-icon-chat-dot-round",class:"send-btn",onClick:e.sendMsg},null,8,["onClick"])])),_:1},8,["modelValue"])])]})),_:1})};var B=n({name:"App",components:{ChatWithWho:_,ChatDemo:S},props:{},setup(e){const t=v(!1),o=v(null);return{isChatTime:t,chatDemo:o,updateOpts:async e=>{t.value=!0,await k(),o.value.initChatSocketIO(e)},handleLinkError:()=>{c.warning("Failed to connect to the chat room, check the console for error messages!"),t.value=!1}}}});const G={class:"chat-demo-content"},K=h("div",{class:"copyright"},[f(" Chat Demo with "),h("a",{href:"https://socket.io/docs/v4/client-installation/",target:"_BLANK"},"Socket.IO Client"),f(" Â©2021 - Present "),h("a",{href:"https://github.com/ArcherGu",target:"_BLANK"},"Archer Gu")],-1);B.render=function(e,t,o,s,a,r){const n=d("ChatWithWho"),l=d("ChatDemo");return m(),u(b,null,[h("div",G,[e.isChatTime?(m(),u(l,{key:1,ref:"chatDemo",onLinkError:e.handleLinkError},null,8,["onLinkError"])):(m(),u(n,{key:0,onUpdateOpts:e.updateOpts},null,8,["onUpdateOpts"]))]),K],64)};const N=V(B);!function(e){const t=[O,L,U];for(const o of t)e.use(o)}(N),N.mount("#app");
